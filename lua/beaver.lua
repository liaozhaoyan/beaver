---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liaozhaoyan.
--- DateTime: 2023/12/31 8:06 AM
---

local unistd = require("posix.unistd")
local cffi = require("beavercffi")
local CcoBeaver = require("coBeaver")
local CasyncPipeRead = require("async.asyncPipeRead")
local conf

function init(f_in, f_out, name, config)
    conf = {
        f_in = f_in,
        f_out = f_out,
        name = name,
        config = config
    }
    return 0
end

local function proc(b, conf)
    local r = CasyncPipeRead.new(b, conf.f_in, 4096, -1)
    print(r:read())
end

function work()
    print(conf.name)
    local b = CcoBeaver.new()
    --print(unistd.read(conf.f_in, 4096))
    local co = coroutine.create(proc)
    coroutine.resume(co, b, conf)
    b:poll()
    return 0
end