---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liaozhaoyan.
--- DateTime: 2024/1/6 11:39 AM
---

local M = {}
local system = require("common.system")

local var = {
    pingpong = {}
}

function M.pingpongBindAdd(fd, co)
    assert(not var.pingpong[fd], "pingpong bind socket is already in use.")
    var.pingpong[fd] = {
        co = co,
        addrs = {},
        cos = {}
    }
end

function M.pingpongAdd(bfd, fd, co, addr)
    print("add", bfd, fd)
    assert(not var.pingpong[bfd].cos[fd], "pingpong work socket is already in use.")
    var.pingpong[bfd].cos[fd] = co
    var.pingpong[bfd].addrs[fd] = addr
end

function M.pingpongDel(fd)
    for bfd, pingpong in pairs(var.pingpong) do
        for i, _ in pairs(pingpong.cos) do
            if fd == i then
                pingpong.addrs[i] = nil
                pingpong.cos[i] = nil
                print("remove", bfd, fd)
                return
            end
        end
    end
    system:dumps(var.pingpong)
    error(string.format("fd: %d is not register.", fd))
end

return M